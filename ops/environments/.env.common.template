# Computor Platform Environment Configuration
# This is the MAIN configuration file for all services
# Copy this to .env.common and adjust values

# ============================================
# SYSTEM CONFIGURATION
# ============================================
SYSTEM_DEPLOYMENT_PATH=/opt/computor
API_ROOT_PATH=/opt/computor/shared
API_LOCAL_STORAGE_DIR=${API_ROOT_PATH}
DOCKER_SOCKET_PATH=/var/run/docker.sock

# Git configuration for workers
SYSTEM_GIT_NAME="Computor Worker"
SYSTEM_GIT_EMAIL=worker@computor.local

# ============================================
# DATABASE CONFIGURATION
# ============================================
# Main PostgreSQL database
POSTGRES_HOST=postgres
POSTGRES_PORT=5437
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD
POSTGRES_DB=computor
POSTGRES_EXTERNAL_PORT=5432

# Temporal PostgreSQL database (separate instance)
TEMPORAL_POSTGRES_PASSWORD=temporal
TEMPORAL_POSTGRES_PORT=5433

# ============================================
# REDIS CONFIGURATION
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD

# ============================================
# TEMPORAL CONFIGURATION
# ============================================
TEMPORAL_HOST=temporal
TEMPORAL_NAMESPACE=default
TEMPORAL_PORT=7233
TEMPORAL_EXTERNAL_PORT=7233
TEMPORAL_UI_PORT=8088

# ============================================
# MINIO OBJECT STORAGE
# ============================================
MINIO_ENDPOINT=minio:9000
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD
MINIO_DEFAULT_BUCKETS=computor-storage
MINIO_REGION=us-east-1
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_MAX_UPLOAD_SIZE=20971520  # 20MB in bytes
MINIO_SECURE=false

# ============================================
# TRAEFIK CONFIGURATION
# ============================================
TRAEFIK_HTTP_PORT=8080
TRAEFIK_HTTPS_PORT=8446

# ============================================
# API CONFIGURATION
# ============================================
API_PORT=8000
API_URL=http://localhost:8000
API_ADMIN_USER=admin
API_ADMIN_PASSWORD=CHANGE_ME_ADMIN_PASSWORD

# ============================================
# WEB FRONTEND (computor-web)
# ============================================
# Backend API URL exposed to the browser
NEXT_PUBLIC_API_URL=http://localhost:8000

# Docker build settings
COMPUTOR_WEB_IMAGE_NAME=computor-web
COMPUTOR_WEB_IMAGE_TAG=latest
COMPUTOR_WEB_REGISTRY=
COMPUTOR_WEB_PORT=3000

# ============================================
# SECURITY TOKENS
# ============================================
# Generate with: openssl rand -base64 32
TOKEN_SECRET=CHANGE_ME_GENERATE_WITH_OPENSSL
AUTH_SECRET=CHANGE_ME_GENERATE_WITH_OPENSSL

# ============================================
# WORKER CONFIGURATION
# ============================================
# Worker replicas
TEMPORAL_WORKER_REPLICAS=1
TESTING_WORKER_REPLICAS=1
MATLAB_TESTING_WORKER_REPLICAS=1

# Testing workers tokens
TESTING_WORKER_TOKEN=CHANGE_ME_WORKER_TOKEN
MATLAB_WORKER_TOKEN=CHANGE_ME_MATLAB_TOKEN

# Testing framework configuration
TESTING_FRAMEWORK_URL=
TESTING_FRAMEWORK_TOKEN=
TESTING_FRAMEWORK_VERSION=latest

# MATLAB configuration
MATLAB_TEST_ENGINE_URL=
MATLAB_TEST_ENGINE_TOKEN=
MATLAB_TEST_ENGINE_VERSION=latest
MATLAB_MLM_LICENSE_FILE=
MATLAB_BASE_IMAGE=matlab-base:latest

# ============================================
# CODER CONFIGURATION (Optional)
# ============================================
# Set to true to enable Coder workspace management
CODER_ENABLED=false

# Coder PostgreSQL database (separate from main DB)
CODER_POSTGRES_USER=coder
CODER_POSTGRES_PASSWORD=CHANGE_ME_CODER_DB_PASSWORD

# Coder admin credentials
CODER_ADMIN_USERNAME=admin
CODER_ADMIN_EMAIL=admin@example.com
CODER_ADMIN_PASSWORD=CHANGE_ME_CODER_PASSWORD

# Admin API secret for Traefik-protected endpoints (generate with: openssl rand -hex 32)
CODER_ADMIN_API_SECRET=CHANGE_ME_GENERATE_WITH_OPENSSL

# Docker configuration (auto-detected by startup.sh if empty)
DOCKER_GID=

# Registry for workspace images
CODER_REGISTRY_PORT=5000

# Coder security settings
CODER_DISABLE_PASSWORD_AUTH=false
CODER_DISABLE_SESSION_EXPIRY_REFRESH=false
CODER_TELEMETRY_ENABLE=false

# URLs for backend integration
# Use http://coder:7080 when backend runs in Docker, http://localhost:7080 for local dev
CODER_URL=http://localhost:7080
# Traefik base URL for workspace access (code-server via /coder/{user}/{workspace}/)
CODER_WORKSPACE_BASE_URL=http://localhost:8080/coder

# ============================================
# EXTENSION CONFIGURATION
# ============================================
EXTENSION_PUBLIC_DOWNLOAD_URL=
EXTENSION_GETTING_STARTED_URL=

# ============================================
# OPTIONAL SERVICES
# ============================================
# Keycloak SSO (uncomment to enable)
# KEYCLOAK_ENABLED=true
# KEYCLOAK_ADMIN=admin
# KEYCLOAK_ADMIN_PASSWORD=admin_password
# KEYCLOAK_DB_PASSWORD=keycloak_secret
# KEYCLOAK_DB_PORT=5434
# KEYCLOAK_PORT=8180
# KEYCLOAK_SERVER_URL=http://localhost:8180
# KEYCLOAK_REALM=computor
# KEYCLOAK_CLIENT_ID=computor-backend
# KEYCLOAK_CLIENT_SECRET=computor-backend-secret

# Test GitLab
TEST_GITLAB_URL=
TEST_GITLAB_TOKEN=
TEST_GITLAB_GROUP_ID=

# ============================================
# DEBUG CONFIGURATION
# ============================================
DEBUG_MODE=development
DISABLE_API_DEBUG_INFO=false

# Dev-only: forward these localhost ports to host.docker.internal inside workspace containers
# Useful when workspace containers need to reach services on the host (e.g. GitLab)
# Comma-separated list of ports (empty = disabled, ignored in production)
# DEV_FORWARD_PORTS=8084