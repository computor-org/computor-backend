{% extends "base.html" %}

{% block title %}Available Templates - Coder Workspaces{% endblock %}

{% block content %}
<div class="templates-page">
    <div class="page-header">
        <h1>Available Templates</h1>
    </div>

    <p class="page-description">
        Choose a template to provision a new workspace. Each template comes pre-configured
        with the necessary tools and environment for development.
    </p>

    <div id="templates-list" class="templates-grid">
        <p class="loading">Loading templates...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadTemplates();
});

function loadTemplates() {
    const container = document.getElementById('templates-list');

    fetch(API_BASE + '/templates')
        .then(r => {
            if (!r.ok) throw new Error('Failed to fetch templates');
            return r.json();
        })
        .then(data => {
            const templates = data.templates || [];
            if (templates.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Templates Available</h3>
                        <p>No workspace templates are currently configured.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = templates.map(tpl => `
                <div class="template-card">
                    <div class="template-icon">${getTemplateIcon(tpl.name)}</div>
                    <div class="template-info">
                        <h3>${tpl.display_name || tpl.name}</h3>
                        <p class="template-description">${tpl.description || 'Development workspace'}</p>
                        <div class="template-meta">
                            <span><strong>ID:</strong> ${tpl.id || 'N/A'}</span>
                            <span><strong>Version:</strong> ${tpl.active_version_id ? 'Active' : 'N/A'}</span>
                        </div>
                    </div>
                    <div class="template-actions">
                        <a href="{{ url_for('coder_provision_page') }}?template=${encodeURIComponent(tpl.name)}" class="btn btn-primary">Use Template</a>
                    </div>
                </div>
            `).join('');
        })
        .catch(err => {
            container.innerHTML = `
                <div class="error-state">
                    <p class="status-error">Failed to load templates: ${err.message}</p>
                </div>
            `;
        });
}

function getTemplateIcon(name) {
    if (name.toLowerCase().includes('python')) {
        return '<svg viewBox="0 0 24 24" width="48" height="48"><path fill="#3776ab" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-5 9h10v2H7v-2zm0-4h10v2H7v-2z"/></svg>';
    }
    if (name.toLowerCase().includes('matlab')) {
        return '<svg viewBox="0 0 24 24" width="48" height="48"><path fill="#e16737" d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>';
    }
    return '<svg viewBox="0 0 24 24" width="48" height="48"><path fill="#666" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/></svg>';
}
</script>
{% endblock %}
